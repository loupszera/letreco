<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palavra do Dia: Artesanato Brasileiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-amber-50 text-stone-800 flex flex-col items-center justify-between min-h-screen p-2 sm:p-4" style="background-image: url('img/fundo.svg'); background-size: cover; background-repeat: no-repeat; background-position: center;">

    <!-- Logo CRAB Sebrae -->
    <div class="flex justify-center items-center w-full max-w-md mt-2 mb-2">
        <img src="img/crab-sebrae-branco.png" alt="Logo CRAB Sebrae" style="height: 60px; object-fit: contain;" />
    </div>
    <!-- Header -->
    <header class="text-center border-b-2 border-amber-200 pb-4 w-full max-w-md">
    <h1 class="text-3xl sm:text-4xl font-bold kalam-font text-white">Palavra do Dia</h1>
    <p class="text-lg text-white">Artesanato Brasileiro</p>
    </header>

    <!-- Game Container -->
    <main id="game-container" class="flex flex-col items-center justify-center gap-6 py-6 w-full">
        <!-- Clue Box -->
        <div id="clue-box" class="p-4 bg-amber-100 border-2 border-dashed border-amber-300 rounded-lg text-center max-w-md">
            <p class="font-semibold text-stone-700">Dica do dia:</p>
            <p id="clue-text" class="text-stone-600"></p>
        </div>

        <!-- Game Grid -->
        <div id="grid" class="grid grid-cols-5 gap-1.5" style="width: 330px; height: 396px;">
            <!-- Tiles will be generated by JS -->
        </div>

        <!-- Toast Message -->
        <div id="toast" class="absolute top-20 bg-stone-800 text-white px-6 py-2 rounded-full text-sm font-semibold opacity-0 transition-opacity duration-300">
            Palavra inválida!
        </div>
    </main>

    <!-- Keyboard -->
    <div id="keyboard" class="flex flex-col gap-1.5 w-full max-w-lg lg:max-w-xl mx-auto">
        <!-- Rows will be generated by JS -->
    </div>

    <!-- Modal for Game Over -->
    <div id="modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 id="modal-title" class="text-2xl font-bold mb-4 kalam-font"></h2>
            <p class="mb-2">A palavra era:</p>
            <p id="modal-word" class="text-2xl font-bold text-amber-600 mb-6"></p>
            <button id="play-again-button" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                Jogar Novamente
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- GAME CONFIGURATION ---
            const WORD_LENGTH = 5;
            const MAX_GUESSES = 6;
            const FLIP_ANIMATION_DELAY = 300; // ms per letter

            // Word bank with clues. All words should be WORD_LENGTH letters and uppercase.
            const wordBank = [
                { word: "BARRO", clue: "Matéria-prima principal da cerâmica e de muitas esculturas figurativas." },
                { word: "RENDA", clue: "Técnica de entrelaçar fios para criar tecidos delicados, como a de bilro." },
                { word: "PALHA", clue: "Material natural usado para fazer cestos, chapéus e bolsas, especialmente do milho ou buriti." },
                { word: "SISAL", clue: "Fibra de uma planta usada para fazer cordas, tapetes e outros objetos resistentes." },
                { word: "BILRO", clue: "Pequeno objeto de madeira ou osso usado para fazer renda de almofada." },
                { word: "CIPOH", clue: "Fibra natural de videiras, usada para criar cestos e móveis rústicos." },
                { word: "COURO", clue: "Pele de animal curtida, usada para fazer roupas, sapatos e selas, típico do sertão." },
                { word: "LINHO", clue: "Fibra têxtil natural usada em bordados e tecelagem de alta qualidade." }
            ];

            // --- STATE MANAGEMENT ---
            let currentRow = 0;
            let currentCol = 0;
            let isGameOver = false;
            let solution = {};

            // --- UI ELEMENTS ---
            const grid = document.getElementById('grid');
            const keyboard = document.getElementById('keyboard');
            const toast = document.getElementById('toast');
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalWord = document.getElementById('modal-word');
            const playAgainButton = document.getElementById('play-again-button');
            const clueText = document.getElementById('clue-text');

            // --- INITIALIZATION ---
            function initializeGame() {
                // Select word of the day based on the date
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
                solution = wordBank[dayOfYear % wordBank.length];

                // Reset state
                currentRow = 0;
                currentCol = 0;
                isGameOver = false;

                // Setup UI
                createGrid();
                createKeyboard();
                updateClue();
                modal.classList.add('hidden');
            }

            // --- UI CREATION ---
            function createGrid() {
                grid.innerHTML = '';
                for (let i = 0; i < MAX_GUESSES * WORD_LENGTH; i++) {
                    const tile = document.createElement('div');
                    tile.classList.add('tile', 'w-16', 'h-16', 'border-2', 'border-amber-200', 'rounded-md', 'relative');
                    tile.innerHTML = `
                        <div class="front absolute w-full h-full flex items-center justify-center text-3xl font-bold uppercase" style="color: #FAFAFA;"></div>
                        <div class="back absolute w-full h-full flex items-center justify-center text-3xl font-bold uppercase text-white"></div>
                    `;
                    grid.appendChild(tile);
                }
            }

            function createKeyboard() {
                keyboard.innerHTML = '';
                const keys = [
                    ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                    ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
                    ['ENTER', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', 'BACK']
                ];

                keys.forEach(row => {
                    const rowDiv = document.createElement('div');
                    rowDiv.classList.add('flex', 'justify-center', 'gap-1.5');
                    row.forEach(key => {
                        const button = document.createElement('button');
                        button.textContent = key;
                        button.id = `key-${key}`;
                        button.classList.add('key', 'h-12', 'sm:h-14', 'rounded-md', 'font-semibold', 'bg-amber-200', 'flex-1', 'flex', 'items-center', 'justify-center', 'uppercase', 'hover:bg-amber-300', 'active:bg-amber-400');
                        if (key.length > 1) {
                            button.classList.add('px-2', 'sm:px-4', 'text-xs', 'sm:text-sm');
                        }
                        button.addEventListener('click', () => handleKeyPress(key));
                        rowDiv.appendChild(button);
                    });
                    keyboard.appendChild(rowDiv);
                });
            }

            function updateClue() {
                clueText.textContent = solution.clue;
            }

            // --- EVENT HANDLING ---
            function handleKeyPress(key) {
                if (isGameOver) return;

                const upperKey = key.toUpperCase();
                if (upperKey === 'BACK' || upperKey === 'BACKSPACE') {
                    deleteLetter();
                } else if (upperKey === 'ENTER') {
                    submitGuess();
                } else if (upperKey.length === 1 && upperKey >= 'A' && upperKey <= 'Z') {
                    addLetter(upperKey);
                }
            }

            document.addEventListener('keydown', (e) => handleKeyPress(e.key));

            playAgainButton.addEventListener('click', initializeGame);

            // --- GAME LOGIC ---
            function addLetter(letter) {
                if (currentCol < WORD_LENGTH) {
                    const tile = getTile(currentRow, currentCol);
                    const front = tile.querySelector('.front');
                    front.textContent = letter;
                    currentCol++;
                }
            }

            function deleteLetter() {
                if (currentCol > 0) {
                    currentCol--;
                    const tile = getTile(currentRow, currentCol);
                    const front = tile.querySelector('.front');
                    front.textContent = '';
                }
            }

            function submitGuess() {
                if (currentCol < WORD_LENGTH) {
                    showToast("Palavra muito curta!");
                    return;
                }

                const guess = getCurrentGuess();
                
                // Note: In a real scenario, you might want to check against a larger dictionary.
                // For this game, any 5-letter word is accepted to focus on the puzzle.

                flipRow(guess);
            }

            function getCurrentGuess() {
                let guess = '';
                for (let i = 0; i < WORD_LENGTH; i++) {
                    guess += getTile(currentRow, i).querySelector('.front').textContent;
                }
                return guess;
            }

            function flipRow(guess) {
                const solutionLetters = solution.word.split('');
                const guessLetters = guess.split('');
                const letterCounts = {};

                // Count letters in the solution for correct/present logic
                solutionLetters.forEach(letter => {
                    letterCounts[letter] = (letterCounts[letter] || 0) + 1;
                });

                // First pass: find correct (green) letters
                guessLetters.forEach((letter, index) => {
                    if (letter === solutionLetters[index]) {
                        styleTile(currentRow, index, 'correct');
                        letterCounts[letter]--;
                    }
                });

                // Second pass: find present (yellow) and absent (gray) letters
                guessLetters.forEach((letter, index) => {
                    if (letter !== solutionLetters[index]) {
                        if (solutionLetters.includes(letter) && letterCounts[letter] > 0) {
                            styleTile(currentRow, index, 'present');
                            letterCounts[letter]--;
                        } else {
                            styleTile(currentRow, index, 'absent');
                        }
                    }
                });

                // Check for win/loss after the flip animation completes
                setTimeout(() => {
                    if (guess === solution.word) {
                        showGameOver(true);
                    } else if (currentRow === MAX_GUESSES - 1) {
                        showGameOver(false);
                    } else {
                        currentRow++;
                        currentCol = 0;
                    }
                }, FLIP_ANIMATION_DELAY * WORD_LENGTH);
            }

            function showGameOver(didWin) {
                isGameOver = true;
                modal.classList.remove('hidden');
                modalWord.textContent = solution.word;
                if (didWin) {
                    modalTitle.textContent = 'Parabéns, você conseguiu!';
                } else {
                    modalTitle.textContent = 'Não foi desta vez...';
                }
            }

            // --- UI UPDATES ---
            function getTile(row, col) {
                return grid.children[row * WORD_LENGTH + col];
            }


            function styleTile(row, col, state) {
                const tile = getTile(row, col);
                const front = tile.querySelector('.front');
                const back = tile.querySelector('.back');
                const letter = front.textContent;

                setTimeout(() => {
                    tile.classList.add('flip');
                    back.textContent = letter;
                    let bgColor, borderColor;
                    switch (state) {
                        case 'correct':
                            bgColor = 'bg-green-600';
                            borderColor = 'border-green-600';
                            break;
                        case 'present':
                            bgColor = 'bg-yellow-500';
                            borderColor = 'border-yellow-500';
                            break;
                        default: // absent
                            bgColor = 'bg-stone-500';
                            borderColor = 'border-stone-500';
                            break;
                    }
                    back.classList.add(bgColor);
                    tile.classList.remove('border-amber-200');
                    tile.classList.add(borderColor);

                    // Update keyboard color
                    updateKeyColor(letter, state);

                }, col * FLIP_ANIMATION_DELAY);
            }

            function updateKeyColor(letter, state) {
                const keyButton = document.getElementById(`key-${letter}`);
                if (!keyButton) return;

                const statePriority = { correct: 3, present: 2, absent: 1 };
                const currentState = keyButton.dataset.state || 'absent';

                if (statePriority[state] > statePriority[currentState]) {
                    keyButton.dataset.state = state;
                    keyButton.className = keyButton.className.replace(/bg-\w+-\d+/g, ''); // remove old bg
                    
                    let keyBgColor;
                    switch (state) {
                        case 'correct':
                            keyBgColor = 'bg-green-600 text-white';
                            break;
                        case 'present':
                            keyBgColor = 'bg-yellow-500 text-white';
                            break;
                        case 'absent':
                            keyBgColor = 'bg-stone-400 text-stone-100';
                            break;
                    }
                    keyButton.classList.add(...keyBgColor.split(' '));
                }
            }

            let toastTimeout;
            function showToast(message) {
                toast.textContent = message;
                toast.classList.remove('opacity-0');
                clearTimeout(toastTimeout);
                toastTimeout = setTimeout(() => {
                    toast.classList.add('opacity-0');
                }, 2000);
            }

            // --- START THE GAME ---
            initializeGame();
        });
    </script>
</body>
</html>
